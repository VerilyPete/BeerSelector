appId: org.verily.FSbeerselector
name: "Config Validation - URL Configuration and Validation"
---
# Test Flow: Configuration Module Validation
# This test verifies config module integration in the UI including:
# - Environment-based URL configuration
# - URL validation in settings
# - Config consistency across components
# - Error handling for invalid configurations
#
# Note: This test focuses on UI-level config validation.
# Unit-level config testing is covered in Jest tests.
#
# Prerequisites:
# - App should be freshly installed or reset to test first-launch flow

# ========================================
# Test 1: First Launch - Config Required
# ========================================

# Step 1: Launch app with cleared state
- launchApp:
    clearState: true

# Step 2: Wait for initialization
- waitForAnimationToEnd:
    timeout: 5000

# Step 3: App should redirect to Settings on first launch
# (when API URLs not configured)
- assertVisible:
    text: "Settings"

# Step 4: Verify welcome message appears
- assertVisible:
    text: "Welcome"

# Step 5: Verify login button is visible
- assertVisible:
    text: "Login to Flying Saucer"

# ========================================
# Test 2: Environment Configuration Display
# ========================================

# Step 6: Scroll to find API Configuration section
# (if visible in development mode)
- scroll:
    direction: DOWN

# Step 7: Check for developer section (may be hidden in production)
- optional: true
  commands:
    - assertVisible:
        id: "developer-section"

# Step 8: If developer section exists, verify environment info
- optional: true
  commands:
    - assertVisible:
        text: "Development"

# ========================================
# Test 3: Login Flow Uses Config URLs
# ========================================

# Step 9: Scroll to login button
- scroll:
    direction: DOWN

# Step 10: Tap "Login to Flying Saucer" button
- tapOn:
    text: "Login to Flying Saucer"

# Step 11: Wait for WebView to load
- waitForAnimationToEnd:
    timeout: 5000

# Step 12: Verify login webview modal appears
- assertVisible:
    id: "login-webview-modal"

# Step 13: Verify WebView loaded (no error message)
# If config URLs are invalid, WebView would show error
- assertNotVisible:
    text: "Could not connect"
    optional: true

# Step 14: Close login modal
- assertVisible:
    id: "close-webview-button"
- tapOn:
    id: "close-webview-button"
- waitForAnimationToEnd

# ========================================
# Test 4: Untappd Config Integration
# ========================================

# Step 15: Scroll to Untappd section
- scroll:
    direction: DOWN

# Step 16: Tap Untappd login button
- tapOn:
    text: "Untappd"

# Step 17: Wait for Untappd WebView to load
- waitForAnimationToEnd:
    timeout: 5000

# Step 18: Verify Untappd webview modal appears
- assertVisible:
    id: "untappd-webview-modal"

# Step 19: Verify Untappd WebView loaded
# External config URLs should work correctly
- assertNotVisible:
    text: "Could not connect"
    optional: true

# Step 20: Close Untappd modal
- assertVisible:
    id: "close-untappd-webview-button"
- tapOn:
    id: "close-untappd-webview-button"
- waitForAnimationToEnd

# ========================================
# Test 5: Config Persistence Across Sessions
# ========================================

# Step 21: Close settings (simulate app backgrounding)
- scroll:
    direction: UP
- tapOn:
    text: "×"
    optional: true
- waitForAnimationToEnd

# Step 22: Navigate back to settings
- scroll:
    direction: DOWN
    optional: true
- tapOn: "Settings"
- waitForAnimationToEnd

# Step 23: Verify settings still accessible
- assertVisible:
    text: "Settings"

# Step 24: Verify login button still works
- scroll:
    direction: DOWN
- assertVisible:
    text: "Login to Flying Saucer"

# ========================================
# Test 6: Multi-Component Config Consistency
# ========================================

# Step 25: Open LoginWebView again
- tapOn:
    text: "Login to Flying Saucer"
- waitForAnimationToEnd:
    timeout: 3000

# Step 26: Verify WebView uses config
- assertVisible:
    id: "login-webview-modal"

# Step 27: Close and open Untappd
- tapOn:
    id: "close-webview-button"
- waitForAnimationToEnd

# Step 28: Open UntappdLoginWebView
- scroll:
    direction: DOWN
- tapOn:
    text: "Untappd"
- waitForAnimationToEnd:
    timeout: 3000

# Step 29: Verify Untappd WebView uses config
- assertVisible:
    id: "untappd-webview-modal"

# Step 30: Close Untappd modal
- tapOn:
    id: "close-untappd-webview-button"
- waitForAnimationToEnd

# ========================================
# Test 7: Config Error Handling
# ========================================

# Step 31: Return to settings screen
- assertVisible:
    text: "Settings"

# Step 32: Verify no error states present
# Config should be working correctly
- assertNotVisible:
    text: "Error"
    optional: true

# Step 33: Verify all buttons are enabled
- assertVisible:
    text: "Refresh All Beer Data"
- assertVisible:
    text: "Login to Flying Saucer"

# ========================================
# Test 8: Navigation Consistency
# ========================================

# Step 34: Navigate away from settings
- scroll:
    direction: UP
- tapOn:
    text: "×"
    optional: true
- waitForAnimationToEnd

# Step 35: Return to settings multiple times
- scroll:
    direction: DOWN
    optional: true
- tapOn: "Settings"
- waitForAnimationToEnd

# Step 36: Verify settings still functional
- assertVisible:
    text: "Settings"
- scroll:
    direction: DOWN
- assertVisible:
    text: "Login to Flying Saucer"

# Step 37: Close settings
- scroll:
    direction: UP
- tapOn:
    text: "×"
    optional: true
- waitForAnimationToEnd

# Test Complete
# ==============
# This test verifies:
# ✓ App redirects to settings on first launch
# ✓ Config module provides URLs to WebView components
# ✓ LoginWebView uses config for kiosk URL
# ✓ UntappdLoginWebView uses config for login URL
# ✓ Config URLs work correctly (no connection errors)
# ✓ Config persists across sessions
# ✓ Multiple components use consistent config
# ✓ No config-related errors in UI
# ✓ Navigation works consistently with config integration
#
# Note: This test validates config integration at the UI level.
# For detailed config validation (invalid URLs, environment switching),
# see Jest unit tests in src/config/__tests__/
