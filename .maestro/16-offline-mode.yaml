appId: com.yourcompany.beerselector
name: Offline Mode - Network State Detection
tags:
  - offline
  - network
  - e2e

---

# Test: Offline Mode with Network State Indicator
#
# This test verifies:
# 1. OfflineIndicator appears when device goes offline
# 2. OfflineIndicator disappears when device comes back online
# 3. Cached data is accessible when offline
# 4. Network-dependent operations show appropriate messages

# Launch the app
- launchApp

# Wait for app to load
- waitForAnimationToEnd

# Verify app loads normally when online
- assertVisible: "All Beer"

# Go to All Beers tab (if not already there)
- tapOn:
    text: "All Beer"
    retryTapIfNoChange: false

# Verify we can see beer list when online
- waitForAnimationToEnd
- scrollUntilVisible:
    element:
      text: ".*"
      matching: contains
    direction: DOWN
    timeout: 5000

# Enable airplane mode to simulate offline
- runFlow:
    when:
      platform: iOS
    commands:
      - openLink: "prefs:root=AIRPLANE_MODE"
      - tapOn: "Airplane Mode"
      - tapOn:
          point: "50%,10%"  # Tap status bar to go back
      - openLink: "beerselector://"

- runFlow:
    when:
      platform: Android
    commands:
      # Android: Open quick settings and enable airplane mode
      - runScript: adb shell cmd connectivity airplane-mode enable
      - waitForAnimationToEnd: 2000

# Verify offline indicator appears
- assertVisible:
    text: "No Internet Connection"
    timeout: 10000

# Verify we can still view cached beer data when offline
- assertVisible: "All Beer"

# Try to access different tabs (cached data should work)
- tapOn: "Beerfinder"
- waitForAnimationToEnd

# Offline indicator should still be visible
- assertVisible: "No Internet Connection"

# Go back to All Beer
- tapOn: "All Beer"
- waitForAnimationToEnd

# Disable airplane mode to go back online
- runFlow:
    when:
      platform: iOS
    commands:
      - openLink: "prefs:root=AIRPLANE_MODE"
      - tapOn: "Airplane Mode"
      - tapOn:
          point: "50%,10%"  # Tap status bar to go back
      - openLink: "beerselector://"

- runFlow:
    when:
      platform: Android
    commands:
      # Android: Disable airplane mode
      - runScript: adb shell cmd connectivity airplane-mode disable
      - waitForAnimationToEnd: 2000

# Wait for network to reconnect
- waitForAnimationToEnd: 5000

# Verify offline indicator disappears (or becomes hidden)
# Note: May need to check that it's NOT visible
- runScript: |
    try {
      output.visible = !maestro.findElement({ text: "No Internet Connection" });
    } catch (e) {
      output.visible = true; // Element not found = offline indicator hidden
    }

# Verify we can still navigate normally
- tapOn: "Beerfinder"
- waitForAnimationToEnd
- assertVisible: "Beerfinder"

# Test complete
