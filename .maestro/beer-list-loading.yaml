# .maestro/beer-list-loading.yaml
# MP-3 Step 3a: E2E Tests for Loading States (TDD Approach)
#
# Purpose: Validate skeleton loading behavior across all beer list screens
# These tests will FAIL initially until SkeletonLoader is implemented - that's correct for TDD!
#
# Test Scenarios:
# 1. Skeleton appears immediately on app launch
# 2. Skeleton disappears when data loads
# 3. Pull-to-refresh shows spinner (not skeleton)
# 4. Loading states work consistently across all tabs

appId: org.verily.FSbeerselector
---
# Test 1: All Beers Tab - Initial Load with Skeleton
- launchApp:
    clearState: true  # Ensure clean state for consistent testing

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "All Beers Tab"

# Skeleton should appear within 100ms (immediate perceived performance)
- assertVisible:
    id: "skeleton-loader"

# Wait for data to load (max 5 seconds)
- waitForAnimationToEnd

# Skeleton should be replaced by beer list
- assertVisible:
    id: "beer-list"

# Skeleton should be completely hidden
- assertNotVisible: "skeleton-loader"

# Verify beer count is shown (data loaded successfully)
- assertVisible:
    id: "beer-count"

---
# Test 2: Beerfinder Tab - Initial Load with Skeleton
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "Beerfinder Tab"

# Skeleton should appear immediately
- assertVisible:
    id: "skeleton-loader"

# Wait for data load
- waitForAnimationToEnd

# Beer list should appear
- assertVisible:
    id: "beer-list"

# Skeleton hidden
- assertNotVisible: "skeleton-loader"

# Action buttons should be visible
- assertVisible: "View Queues"
- assertVisible: "Rewards"

---
# Test 3: Tasted Brews Tab - Initial Load with Skeleton
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "Tasted Brews Tab"

# Skeleton appears
- assertVisible:
    id: "skeleton-loader"

# Wait for My Beers data
- waitForAnimationToEnd

# Either beer list or empty state should appear
# (Depends on whether user has tasted beers)
- runFlow:
    when:
      visible: "beer-list"
    commands:
      - assertNotVisible: "skeleton-loader"
      - assertVisible:
          id: "beer-count"

- runFlow:
    when:
      visible:
        text: "No beers in your current round yet"
    commands:
      - assertNotVisible: "skeleton-loader"

---
# Test 4: Pull-to-Refresh - No Skeleton
appId: org.verily.FSbeerselector
---
- launchApp

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "All Beers Tab"

# Wait for initial load
- waitForAnimationToEnd

- assertVisible:
    id: "beer-list"

# Pull down to refresh
- swipe:
    direction: DOWN
    duration: 500

- swipe:
    direction: UP
    duration: 500

# Wait for refresh animation
- waitForAnimationToEnd

# Skeleton should NOT appear during refresh
- assertNotVisible: "skeleton-loader"

# Beer list should remain visible
- assertVisible:
    id: "beer-list"

---
# Test 5: Tab Switching - Skeleton Caching
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

# Load All Beers
- tapOn: "All Beers Tab"
- waitForAnimationToEnd
- assertVisible:
    id: "beer-list"

# Switch to Beerfinder
- tapOn: "Beerfinder Tab"

# Should show skeleton on first load
- assertVisible:
    id: "skeleton-loader"

- waitForAnimationToEnd

- assertVisible:
    id: "beer-list"
- assertNotVisible: "skeleton-loader"

# Switch back to All Beers
- tapOn: "All Beers Tab"

# Should NOT show skeleton (data already loaded)
# This tests that components maintain their data
- assertVisible:
    id: "beer-list"
- assertNotVisible: "skeleton-loader"

---
# Test 6: Skeleton Visual Consistency
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "All Beers Tab"

# Capture skeleton appearance
- assertVisible:
    id: "skeleton-loader"

# Verify skeleton has multiple items (not just one)
# This ensures skeleton looks like a populated list
- runFlow:
    commands:
      # Wait a moment to observe skeleton
      - wait: 500

      # Skeleton should be visible during this time
      - assertVisible:
          id: "skeleton-loader"

# Wait for data
- waitForAnimationToEnd

# Verify smooth transition
- assertVisible:
    id: "beer-list"

---
# Test 7: Fast Data Load - Skeleton Still Appears
appId: org.verily.FSbeerselector
---
# This test ensures skeleton appears even if data loads quickly
# Important for perceived performance consistency

- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "Tasted Brews Tab"

# Skeleton should flash briefly even if data loads fast
# This provides visual feedback that loading occurred
- runFlow:
    commands:
      - assertVisible:
          id: "skeleton-loader"

# Data loads
- waitForAnimationToEnd

# End state should be correct (beer list or empty)
- runFlow:
    when:
      visible: "beer-list"
    commands:
      - assertNotVisible: "skeleton-loader"

---
# Test 8: Search While Loading
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "All Beers Tab"

# Tap search bar while skeleton is visible
- tapOn:
    id: "search-bar"

# Search should be accessible even during loading (better UX)
- inputText: "IPA"

# Data loads
- waitForAnimationToEnd

# Results should be filtered
- assertVisible:
    id: "beer-list"

- assertNotVisible: "skeleton-loader"

---
# Test 9: Error State - No Skeleton
appId: org.verily.FSbeerselector
---
# This test verifies error states don't show skeleton
# Note: Requires network disconnection or simulated error

- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

# Simulate offline mode (if possible)
# Otherwise this test documents expected behavior

- tapOn: "All Beers Tab"

# If error occurs, skeleton should be replaced by error message
# - assertNotVisible: "skeleton-loader"  (after error)
# - assertVisible: "Try Again"  (error button)

# This test may need manual network disconnection
# Or mocking at the app level

---
# Test 10: Accessibility - Loading State Announcement
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

- tapOn: "All Beers Tab"

# Skeleton should be accessible
# Screen readers should announce loading state

- assertVisible:
    id: "skeleton-loader"

# Wait for load
- waitForAnimationToEnd

# Final state should be accessible
- assertVisible:
    id: "beer-list"

---
# Test 11: Performance - Skeleton Appears Quickly
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

# Measure time to skeleton appearance
- tapOn: "Beerfinder Tab"

# Skeleton should appear within 100ms
# (This is a critical performance metric)
- assertVisible:
    id: "skeleton-loader"

# If this assertion fails, skeleton rendering is too slow

---
# Test 12: All Tabs - Consistent Loading Behavior
appId: org.verily.FSbeerselector
---
- launchApp:
    clearState: true

# Dismiss Expo dev menu if present
- runFlow:
    when:
      visible: "Reload"
    commands:
      - pressKey: Escape
      - waitForAnimationToEnd

# Test each tab has consistent loading UX
- tapOn: "All Beers Tab"
- assertVisible:
    id: "skeleton-loader"
- waitForAnimationToEnd
- assertNotVisible: "skeleton-loader"

- tapOn: "Beerfinder Tab"
- assertVisible:
    id: "skeleton-loader"
- waitForAnimationToEnd
- assertNotVisible: "skeleton-loader"

- tapOn: "Tasted Brews Tab"
- assertVisible:
    id: "skeleton-loader"
- waitForAnimationToEnd
- assertNotVisible: "skeleton-loader"

# All tabs should behave consistently
